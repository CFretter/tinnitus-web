<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tinnitus Reproduction Generator</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
  }
  #sliders {
    margin-top: 20px;
  }
  .switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
}
  /* Hide default HTML checkbox */
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}


</style>
</head>
<body>
  <h1>Tinnitus Reproduction Generator</h1>
  <button id="playButton">Play</button>
  <br><br>
  <div id="sideSelector">
   
        <input type="radio" name="side" value="left" id="left" checked="checked">
        <label for="l">left</label>
    </div>
    <div>
        <input type="radio" name="side" value="right" id="right">
        <label for="r">right</label>
    </div>
   
     </div>
    <br>
    <div style="width: 400px;">
      <label for="volumeSlider">Volume:</label>
    <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5" style="width:85%">
    <span id="volumeLabel"></span>
    </div>
    <br>
    <label for="frequencySlider">Frequency:</label>
    <input type="range" id="frequencySlider" min="100" max="18000" step="1" value="1000" style="width:85%">
    <span id="frequencyLabel">1000 Hz</span>
    <br>
    <label for="bandwidthSlider">Bandwidth:</label>
    <input type="range" id="bandwidthSlider" min="1" max="500" step="1" value="100" style="width:85%">
    <span id="bandwidthLabel">100 Hz</span>
  </div>

  <script>
    // Initialize variables
    let audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let whiteNoise;
    let gainNode;
    let pannerNode;
    let bandpassFilter;
    let isPlaying = false;
    let side =false;

    // Create white noise buffer
    function createWhiteNoiseBuffer() {
      let bufferSize = 2 * audioCtx.sampleRate;
      let noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
      let output = noiseBuffer.getChannelData(0);

      for (let i = 0; i < bufferSize; i++) {
        output[i] = Math.random() * 2 - 1;
      }

      return noiseBuffer;
    }

    // Create bandpass filter
    function createBandpassFilter() {
      let filter = audioCtx.createBiquadFilter();
      filter.type = 'bandpass';
      filter.frequency.value = parseFloat(document.getElementById('bandwidthSlider').value); // default frequency
      let bandwidthValue = parseFloat(document.getElementById('bandwidthSlider').value);
      filter.Q.value = 10//filter.frequency.value / bandwidthValue; // default Q factor
      filter.gain.value=1
      return filter;
    }

    // Update bandpass filter parameters
    function updateFilterParams() {
      console.log("updateFilterParams()");
      bandpassFilter.frequency.value = parseFloat(document.getElementById('frequencySlider').value);
      let bandwidthValue = parseFloat(document.getElementById('bandwidthSlider').value);
      let nyquist = audioCtx.sampleRate / 2;
      bandpassFilter.Q.value = bandpassFilter.frequency.value / bandwidthValue;
      console.log(bandwidthValue,bandpassFilter.Q.value)
      // Update labels
      document.getElementById('frequencyLabel').textContent = bandpassFilter.frequency.value + ' Hz';
      document.getElementById('bandwidthLabel').textContent = bandwidthValue + ' Hz';
    }

    // Create audio graph
    function createAudioGraph() {
      whiteNoise = audioCtx.createBufferSource();
      whiteNoise.loop=true
      whiteNoise.buffer = createWhiteNoiseBuffer();

      bandpassFilter = createBandpassFilter();

      pannerNode = audioCtx.createPanner();
      pannerNode.setPosition(-1, 0, 0);//If you want it to play on the left channel
      gainNode = audioCtx.createGain();
      whiteNoise.connect(bandpassFilter).connect(pannerNode).connect(gainNode).connect(audioCtx.destination);
    }
createAudioGraph()
    // Event listeners
    document.getElementById('playButton').addEventListener('click', function() {
      if (!isPlaying) {
        createAudioGraph();
        whiteNoise.start();
        isPlaying = true;
        document.getElementById('playButton').textContent = 'Stop';
      } else {
        whiteNoise.stop();
        isPlaying = false;
        document.getElementById('playButton').textContent = 'Play';
      }
    });

    document.getElementById('left').addEventListener('input', function() {
     
      side=true;
      pannerNode.setPosition(-1, 0, 0);//If you want it to play on the left channel
   
    });
     document.getElementById('right').addEventListener('input', function() {
    
      side=false;
      pannerNode.setPosition(1, 0, 0);//If you want it to play on the left channel
   
       
    });
    document.getElementById('volumeSlider').addEventListener('input', function() {
      gainNode.gain.value = parseFloat(this.value);
    });

    document.getElementById('frequencySlider').addEventListener('input', function() {
      updateFilterParams();
    });

    document.getElementById('bandwidthSlider').addEventListener('input', function() {
      updateFilterParams();
    });
  </script>
</body>
</html>
